#!/bin/bash
set -e

# Create skol group if it doesn't exist
if ! getent group skol > /dev/null 2>&1; then
    groupadd --system skol
    echo "Created group 'skol'"
fi

# Create skol user if it doesn't exist
if ! getent passwd skol > /dev/null 2>&1; then
    useradd --system --gid skol --home-dir /opt/skol --shell /bin/false skol
    echo "Created user 'skol'"
fi

# Create log directory
mkdir -p /var/log/skol
chown skol:skol /var/log/skol
chmod 755 /var/log/skol

# Create opt directory for skol
mkdir -p /opt/skol
chown skol:skol /opt/skol

# Install systemd service
if [ -d /run/systemd/system ]; then
    cp /usr/share/skol-django/skol-django.service /etc/systemd/system/
    systemctl daemon-reload
    systemctl enable skol-django.service
    echo "SKOL Django service installed. Start with: systemctl start skol-django"
fi

#DEBHELPER#

exit 0
